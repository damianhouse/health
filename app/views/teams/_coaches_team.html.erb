
<table class="table table-responsive table-hover team coach">

  <% @coach.users.each do |user| %>
    <% user_note = user.notes.where(coach_id: @coach.id) %>
    <tr>
      <td class="avatar">
        <% if user.avatar_url != nil %>
          <span class="badge"><img src="<%= user.avatar_url %>" alt="user avatar" style="width:75px;height:75px;" /></span>
        <% else %>
          <span class="badge"><img src="/assets/generic_avatar.jpg" alt="alt avatar" style="width:75px;height:75px;" /></span>
        <% end %>
      </td>
      <td class="details">
        <div class="name"><%= user.first %> <%= user.last %></div>
        <div class="email"><%= user.email %></div>
        <div class="details">
          <%= link_to 'View Profile', user %>
        </div>
      </td>
      <td>
        <% if user_note.empty? == false %>
            <span><%= link_to 'User Notes', user_note.first %></span>
        <% else %>
            <%= render partial: "notes_form", locals: { user: user} %>
        <% end %>
      </td>
      <!-- <td>
        <% if user.conversations.length >= 1 %>
          <% convo = user.conversations.find_by(coach_id: @coach.id) %>
          <% if convo.messages.last != nil && convo.messages.last.read == nil && convo.messages.last.coach_id == nil%>
            <i class="status msg new"></i><span><i>No new messages</i></span>
          <% elsif convo.messages.last != nil && convo.messages.last.read == nil && convo.messages.last.coach_id != nil%>
            <i class="status msg unread"></i><span><i>New Message</i></span>
          <% elsif convo.messages.last != nil && convo.messages.last.read != nil %>
            <i class="status msg new"></i><span><i>No new messages</i></span>
          <% elsif convo.messages.last == nil %>
            <i class="status msg empty"></i><span><i>No messages</i></span>
          <% end %>
        <% elsif user.conversations.length == 0 %>
          <i class="status msg empty"></i><span><i>No messages</i></span>
        <% end %>
      </td> -->
      <td>
        <% if user.conversations.length >= 1 %>
          <% user.conversations.each do |convo| %>
            <% if convo.coach_id == @coach.id %>
                <span><%= link_to 'View Conversation', convo%></span>
            <% end %>
          <% end %>
        <% else %>
          <%= render partial: "conversation_form", locals: { user: user} %>
        <% end %>
      </td>
    </tr>
  <% end %>
</table>
